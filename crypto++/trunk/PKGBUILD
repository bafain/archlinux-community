# Maintainer: Baptiste Jonglez <archlinux at bitsofnetworks.org>
# Contributor: Giovanni Scafora <giovanni@archlinux.org>
# Contributor: Alexander RÃ¸dseth <rodseth@gmail.com>
# Contributor: Andrea Scarpino <andrea@archlinux.org>
# Contributor: Kritoke <kritoke@gamebox.net>
# Contributor: jlvsimoes <jlvsimoes@oninet.pt>

pkgname=crypto++
pkgver=6.0.0
_srcver=${pkgver//./}
pkgrel=2
pkgdesc="A free C++ class library of cryptographic schemes"
arch=('x86_64')
url="https://www.cryptopp.com/"
license=('custom')
depends=('gcc-libs')
makedepends=('unzip')
# Fix https://bugs.archlinux.org/task/56689
install="crypto++.install"
source=("https://www.cryptopp.com/cryptopp${_srcver}.zip"
        'libcrypto++.pc')
# Checksums from https://www.cryptopp.com/release600.html
sha1sums=('290dfc1948b860b29da40f8c5559f6559ce787db'
          '7a6c6fc7aed96ff7be554eee60450a1914b0cd95')
sha256sums=('64ac2db96b3f1b7a23675e2be95d16c96055edffa2d5e2de6245fdb6baa92dda'
            '14228b0d1a6f07572090ab17b60bf9829308d174e763eb31966f723b0cb51134')
sha512sums=('7a60c28be1fc9418adeabe8c66d868b46e65fb3d77d308b9431b16905cde7faa670180619150e849ae44d70f44aa8501a0a0c4354ec84f194fd8138d14aca9bf'
            'bba4ff9c01e353f0336e01836fd1418a08f43ab9215f678cc80cc94954d689e94e1425c7ed95f9b12d210bfc73574c98d0579b1356232c50f32f342395408ac2')

build() {
  CXXFLAGS+=" -DNDEBUG -fPIC" make dynamic cryptest.exe
}

check() {
  make test
}

package() {
  make install DESTDIR="$pkgdir" PREFIX="/usr"
  # Install pkgconfig file
  install -d "${pkgdir}/usr/lib/pkgconfig"
  install -m644 "${srcdir}/libcrypto++.pc" "${pkgdir}/usr/lib/pkgconfig/libcrypto++.pc"
  # Remove cryptest.exe and test files, only needed for check() and bloats the package
  # because cryptest.exe is linked statically.
  rm "${pkgdir}/usr/bin/cryptest.exe"
  rmdir "${pkgdir}/usr/bin/"
  rm -r "${pkgdir}/usr/share/cryptopp/"
  # Install license
  install -D -m644 License.txt "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
