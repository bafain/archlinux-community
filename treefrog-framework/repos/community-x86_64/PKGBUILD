# $Id$
# Maintainer: Felix Yan <felixonmars@archlinux.org>

pkgname=treefrog-framework
pkgver=1.21.0
pkgrel=2
pkgdesc="High-speed C++ MVC Framework for Web Application"
arch=('x86_64')
url="https://github.com/treefrogframework/treefrog-framework"
license=('BSD')
depends=('qt5-declarative' 'libmongoc')
makedepends=('qt5-tools')
source=("$pkgname-$pkgver.tar.gz::https://github.com/treefrogframework/treefrog-framework/archive/v$pkgver.tar.gz")
sha512sums=('779ee0eeeeefc48f1f6aac696653e78f8f825febfd53fa8a9d60ba0a991e458c470c6cddd050de1feee42124239bf306a0335b137dcd23a6cb27a1dc7a7b6029')

prepare() {
  cd $pkgname-$pkgver
  rm -r 3rdparty

  sed -i 's|LIBS += ../3rdparty/mongo-c-driver/libmongoc.a|LIBS += -lmongoc-1.0\nINCLUDEPATH += /usr/include/libbson-1.0 /usr/include/libmongoc-1.0|' src/corelib.pro
  sed -i 's|exit $RET||' configure
}

build() {
  cd $pkgname-$pkgver
  ./configure --prefix=/usr
  
  cd src
  make
}

package() {
  cd $pkgname-$pkgver/src
  make INSTALL_ROOT="$pkgdir" install

  install -Dm644 ../copyright "$pkgdir"/usr/share/licenses/$pkgname/copyright
}
