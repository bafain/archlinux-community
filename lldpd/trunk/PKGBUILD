# $Id$
# Maintainer: SÃ©bastien "Seblu" Luttringer
# Contributor: Brian Bidulock <bidulock@openss7.org>

pkgname=lldpd
pkgver=1.0.1
pkgrel=1
pkgdesc='802.1ab implementation (LLDP) to help you locate neighbors'
arch=('x86_64')
url='https://vincentbernat.github.io/lldpd/'
license=('custom:ISC' 'GPL')
depends=('glibc' 'libevent' 'libbsd' 'zlib' 'openssl' 'pciutils' 'perl'
         'libxml2' 'net-snmp' 'jansson')
backup=('etc/lldpd.conf')
validpgpkeys=('AEF2348766F371C689A7360095A42FE8353525F9') # Vincent Bernat <bernat@luffy.cx>
source=("https://media.luffy.cx/files/lldpd/lldpd-$pkgver.tar.gz"
        "lldpd-$pkgver.tar.gz.sig::https://media.luffy.cx/files/lldpd/lldpd-$pkgver.tar.gz.gpg"
        'LICENSE'
        'lldpd.service'
        'lldpd.sysusers'
        'lldpd.tmpfiles')
sha256sums=('450b622aac7ae1758f1ef82f3b7b94ec47f2ff33abfb0e6ac82555b9ee55f151'
            'ccb7eb93200cfab9c6895194c13e28d56a018befc182d2642f9f408136e31ae3'
            'e53348ce276358e9997014071c5294b36a18c4b34f32f00ee57b9acce0aafd63'
            'b64af8bce17e0ba82bb614be16d2a183cc4f7f69bfc7d08e1430da63269f045a'
            'a1d9097c08945651385e44ce9c070037f502dd789245212ea3d2782b3ba0037b'
            'df64ebadacb832c4a9dcbdd531848ae70c21d67d309c7397163ba8db7e31248b')

build() {
  cd $pkgname-$pkgver
  ./configure \
    --prefix=/usr \
    --sysconfdir=/etc \
    --sbindir=/usr/bin \
    --with-snmp \
    --with-xml \
    --with-readline \
    --with-privsep-user=lldpd \
    --with-privsep-group=lldpd \
    --with-privsep-chroot=/run/lldpd/chroot \
    --with-lldpd-ctl-socket=/run/lldpd/socket \
    --with-lldpd-pid-file=/run/lldpd/pid
  make
}

check() {
  cd $pkgname-$pkgver
  make check
}

package() {
  # config stuff
  install -D -m 644 /dev/null "$pkgdir/etc/lldpd.conf"
  install -d -m 755  "$pkgdir/etc/lldpd.d"
  # systemd stuff
  install -D -m 644 lldpd.service "$pkgdir/usr/lib/systemd/system/lldpd.service"
  install -D -m 644 lldpd.sysusers "$pkgdir/usr/lib/sysusers.d/lldpd.conf"
  install -D -m 644 lldpd.tmpfiles "$pkgdir/usr/lib/tmpfiles.d/lldpd.conf"
  # license
  install -D -m 644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"

  cd $pkgname-$pkgver
  make DESTDIR="$pkgdir" install
}

# vim:set ts=2 sw=2 et:
